T.cache("X.App.ZoneDragDrop","K,X.ZoneDragDrop",function(j){var t=K.entity(j.pkg),c=K.entity(j.dps[1],true);j=document;var o=j.body,l=1,k=2,e=K.guid("x_app_zdd_bar_"),i=K.guid("x_app_zdd_pointer_"),h=K.guid("x_app_zdd_css_"),u=".<#=@styleId#>_pointer{position:absolute;height:14px;overflow:hidden;line-height:14px;padding:1px 2px;border:solid 2px #ccc;color:#fff;}.<#=@styleId#>_bgred{background-color:red}.<#=@styleId#>_bgreen{background-color:green}.<#=@styleId#>_ib{position:absolute;overflow:hidden;display:none;border-width:3px;}.<#=@styleId#>_ib div{overflow:hidden;background-color:#000;}.<#=@styleId#>_ib_h{border-color:transparent #000;border-style:dashed solid;}.<#=@styleId#>_ib_h div{height:2px;}.<#=@styleId#>_ib_v{border-color:#000 transparent;border-style:solid dashed;}.<#=@styleId#>_ib_v div{width:2px;height:100%}";
function m(){if(!m.append){m.append=true;T.load({type:"css",id:h,code:K.tpFilled(u,{styleId:h})})}}var v=h+"_pointer",p=h+"_bgred",q=h+"_bgreen",w=h+"_ib",r=h+"_ib_h",s=h+"_ib_v";t.ZoneDragDrop=K.clazz(c,function(x,y,f,z,n){K.mix(f,{ANCHOR_HORIZONTAL:1,ANCHOR_VERTICAL:2,TEXT_ALLOW:"\u53ef\u653e\u7f6e",TEXT_DISALLOW:"\u4e0d\u53ef\u653e\u7f6e"});n=f.ANCHOR_HORIZONTAL|f.ANCHOR_VERTICAL;return{ctor:function(b){m();var a=this;b=K.mix({anchorPosition:n,textAllow:f.TEXT_ALLOW,textDisallow:f.TEXT_DISALLOW},
b);a.on(c.DRAG_START,a._$dragStart=K.bind(a._dragStart,a));a.on(c.DRAG_END,a._$dragEnd=K.bind(a._dragEnd,a));a.on(c.HOVER_CHILD_PLACE_CHANGED,a._$hoverChildPlaceChanged=K.bind(a._hoverChildPlaceChanged,a));a.on([c.WIN_SCROLL,c.ZONE_SCROLL],a._$zoneScroll=K.bind(a._zoneScroll,a));a.on(c.DRAG_MOVE,a._$dragMove=K.bind(a._dragMove,a));a.on(c.HOVER_NODE_CHANGED,a._$dragMoveHoverNodeChanged=function(d){d.cancel=K.nodeIn(d.hoverNode,e)});K.mix(a,b)},_createBar:function(){if(!K(e)){var b=K("div",{id:e});
b.className=w;o.appendChild(b);b.appendChild(K("div",true))}},_updateBarPositionUI:function(b,a,d){if(b===f.ANCHOR_HORIZONTAL){K.nodeClass(e,s,r);K.nodeStyle(e,{width:a.width-6,height:2,display:"block"});c.TOP===d?K.nodeStyle(e,{left:a.x,top:a.y-2}):K.nodeStyle(e,{left:a.x,top:a.y+a.height-2})}else if(b===f.ANCHOR_VERTICAL){K.nodeClass(e,r,s);K.nodeStyle(e,{height:a.height-6,width:2,display:"block"});c.LEFT===d?K.nodeStyle(e,{left:a.x-2,top:a.y}):K.nodeStyle(e,{left:a.x+a.width-2,top:a.y})}},_moveBar:function(b,
a){var d=this,g=false;if(d.anchorPosition&f.ANCHOR_HORIZONTAL)if(b&c.TOP){d._updateBarPositionUI(f.ANCHOR_HORIZONTAL,a,c.TOP);g=true}else if(b&c.BOTTOM){d._updateBarPositionUI(f.ANCHOR_HORIZONTAL,a,c.BOTTOM);g=true}else K.nodeStyle(e,{display:"none"});if(!g&&d.anchorPosition&f.ANCHOR_VERTICAL)if(b&c.LEFT)d._updateBarPositionUI(f.ANCHOR_VERTICAL,a,c.LEFT);else b&c.RIGHT?d._updateBarPositionUI(f.ANCHOR_VERTICAL,a,c.RIGHT):K.nodeStyle(e,{display:"none"})},_hideBar:function(){K.nodeStyle(e,{display:"none"})},
_dragStart:function(b){var a=this;if(b.dragChild){K.nodeStyle(b.dragChild,{opacity:0.4});a._createBar()}},_updatePointer:function(b){var a=K(i),d=K.body(),g;if(!a){a=K("div",{id:i});a.className=v;o.appendChild(a)}g=K.nodeBound(a);K.nodeStyle(a,{left:Math.max(0,Math.min(b.pageX+10,d.maxWidth-g.width)),top:Math.max(0,Math.min(b.pageY+18,d.maxHeight-g.height)),display:"block"})},_changePointer:function(b){var a=b===l?q:p,d=b===k?q:p,g=this;K.nodeClass(i,d,a);K.nodeVal(i,b===l?g.textAllow:g.textDisallow)},
_hidePointer:function(){K.nodeStyle(i,{display:"none"})},_dragMove:function(b){var a=this;a._updatePointer(b.evtXY)},_dragEnd:function(b){var a=this;a._hideBar();a._hidePointer();b.dragChild&&K.nodeStyle(b.dragChild,{opacity:1});if(b.atPlace)if(c.TOP&b.side||c.LEFT&b.side)b.dropZone.insertBefore(b.dragChild,b.dropChild);else if(c.BOTTOM&b.side||c.RIGHT&b.side){for(a=b.dropChild.nextSibling;a&&a.nodeType!=1;)a=a.nextSibling;b.dropZone.insertBefore(b.dragChild,a);if(!a)b.dropZone.scrollTop=b.dropZone.scrollHeight}},
_hoverChildPlaceChanged:function(b){var a=this;if(b.hoverChild!=b.dragChild){if(a.anchorPosition===n)b.sideChanged&&a._moveBar(b.side,b.childBound);else b.positionChanged&&a._moveBar(b.position,b.childBound);b.atPlace?a._changePointer(l):a._changePointer(k)}else{a._hideBar();a._changePointer(k)}},_zoneScroll:function(){var b=this;b._hideBar();b._changePointer(k)},dispose:function(){var b=this;b.un(c.DRAG_START,b._$dragStart);b.un(c.DRAG_END,b._$dragEnd);b.un(c.HOVER_CHILD_PLACE_CHANGED,b._$hoverChildPlaceChanged);
b.un([c.WIN_SCROLL,c.ZONE_SCROLL],b._$zoneScroll);b.un(c.DRAG_MOVE,b._$dragMove);b.un(c.HOVER_NODE_CHANGED,b._$dragMoveHoverNodeChanged);x.dispose.call(b);K.nodeDel(i);K.nodeDel(e)}}})});
