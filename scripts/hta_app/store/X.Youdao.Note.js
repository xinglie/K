T.cache("X.Youdao.Note","K,X.HTA.Iframe,X.JSON,X.DataCache",function(g){var k=K.entity(g.pkg),n=K.access(g.dps[1]),o=K.access(g.dps[2]);g=K.access(g.dps[3]);var h=new g(-1),f={checkNoteLogin:"http://note.youdao.com/auth/urs/login.json?app=web",login:"https://reg.163.com/logins.jsp",noteType:"http://note.youdao.com/yws/mapi/filemeta?method=get&keyfrom=web&dp=1",writeNote:"http://note.youdao.com/yws/mapi/file?method=putfile&keyfrom=web",noteIndex:"http://note.youdao.com/web",readNote:"http://note.youdao.com/yws/mapi/file?method=get&keyfrom=web&dp=0&p=<#=@notePath#>&v=-1"};
function p(d){var a="noteLogin";if(h.has(a))d(h.get(a));else{var b=new K.XHR;b.send({url:f.checkNoteLogin,done:function(c){c=o.parse(c.responseText);c.login&&h.set(a,c.login);d(c.login)}})}}function q(d){k.Note.fire(k.Note.LOGIN_START);var a=new n;a.on(n.LOADED,function(b){if(~b.url.indexOf("logins.jsp")){b.nodeById("username").value="kooboy_li@163.com";b.nodeById("password").value="woaigaoshang";b.nodeById("url").value=f.noteIndex;b.nodeById("loginBtn").click()}else if(~b.url.indexOf("/web")){d();
a.navigate("about:blank")}else if(~b.url.indexOf("about:blank")){a.dispose();a=null;k.Note.fire(k.Note.LOGIN_FINISH)}});a.navigate(f.login)}function l(d){p(function(a){a?d():q(d)})}k.Note=K.mix({LOGIN_START:"_login_start",LOGIN_FINISH:"_login_finish",getNoteTypes:function(d){var a="noteTypes";if(h.has(a))K.isFn(d)&&d(h.get(a));else l(function(){var b=new K.XHR;b.send({url:f.noteType,done:function(c){c=o.parse(c.responseText);for(var i=[],e,m=0,j;m<c.length;m++){j=c[m];if(j.p!="/"){e||(e={typePath:j.p,
typeName:j.tl});i.push({typePath:j.p,typeName:j.tl})}}e={list:i,prior:e};h.set(a,e);K.isFn(d)&&d(e)}})})},create:function(d,a){var b=this;b.getNoteTypes(function(c){var i=new K.XHR;c=K.mix({title:K.guid("x_youdao_note_"),content:K.now(),typePath:c.prior.typePath},d);i.send({url:f.writeNote,data:"au=&bs="+c.content+"&p="+c.typePath+"/"+K.guid()+"&src=&su=&tl="+c.title+"&v=-1",done:function(e){K.isFn(a)&&a(e.responseText)}})})},update:function(d,a){var b=K.mix({title:K.guid("x_youdao_note_"),content:K.now(),
notePath:""},d);b.notePath?l(function(){var c=new K.XHR;c.send({url:f.writeNote,data:"au=&bs="+b.content+"&p="+b.notePath+"&src=&su=&tl="+b.title+"&v=-1",done:function(i){K.isFn(a)&&a(i.responseText)}})}):alert("notePath not set")},get:function(d,a){l(function(){var b=new K.XHR;b.send({url:K.tpFilled(f.readNote,{notePath:d}),done:function(c){K.isFn(a)&&a(c.responseText)}})})}},K.ME)});
